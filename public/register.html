<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Registrarse - RedSocial</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="register.css" />
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
  <nav>
    <div class="nav-left"><a href="index.html" class="brand">游댱 Souls Social</a></div>
    <div class="nav-right" id="navRight"></div>
  </nav>

  <main class="auth-container">
    <div class="auth-card">
      <h2>Crear cuenta</h2>

      <form id="registerForm" class="auth-form">
        <input name="username" class="auth-input" type="text" placeholder="Nombre de usuario" required />
        <input name="email" class="auth-input" type="email" placeholder="Correo electr칩nico" required />
        <div class="password-wrapper" style="width:100%;">
          <div class="input-with-icon" style="padding-right:92px;">
            <i data-lucide="lock"></i>
            <input id="regPassword" name="password" class="auth-input" type="password" placeholder="Contrase침a" required />
          </div>
          <button type="button" class="password-toggle" aria-label="Mostrar contrase침a" data-target="regPassword">
            <i data-lucide="eye"></i>
          </button>
        </div>

        <button type="submit" class="btn">Registrarse</button>
      </form>

      <div style="margin-top:12px;color:var(--muted);font-size:0.95rem;">
        쯏a tienes cuenta? <a href="login.html" style="color:var(--accent-2)">Inicia sesi칩n</a>
      </div>
    </div>
  </main>

  <script>

    lucide.createIcons();

    // render navRight
    (function(){
      const navRight = document.getElementById('navRight');
      const username = localStorage.getItem('username');
      navRight.innerHTML = username
        ? `<span>游녻 ${username}</span><button id="logoutBtn">Cerrar sesi칩n</button>`
        : `<a href="login.html">Iniciar sesi칩n</a>`;
      const logoutBtn = document.getElementById('logoutBtn');
      if (logoutBtn) logoutBtn.addEventListener('click', ()=>{ localStorage.clear(); location.href='login.html'; });
    })();

    // password toggle (same as login)
    document.querySelectorAll('.password-toggle').forEach(btn=>{
      btn.addEventListener('click', ev=>{
        ev.preventDefault();
        const targetId = btn.getAttribute('data-target');
        const input = document.getElementById(targetId);
        if (!input) return;
        const showing = input.type === 'text';
        input.type = showing ? 'password' : 'text';
        const icon = btn.querySelector('i');
        if (icon) {
          icon.setAttribute('data-lucide', showing ? 'eye' : 'eye-off');
          lucide.createIcons();
        }
        try { input.focus(); input.setSelectionRange(input.value.length, input.value.length); } catch {}
        btn.setAttribute('aria-label', showing ? 'Mostrar contrase침a' : 'Ocultar contrase침a');
      });
    });

    // register submit with animation + feedback
    document.getElementById('registerForm').addEventListener('submit', async e=>{
      e.preventDefault();
      const btn = e.target.querySelector('button[type="submit"]');
      btn.disabled = true;
      btn.classList.add('loading');
      try {
        const data = Object.fromEntries(new FormData(e.target).entries());
        const res = await fetch('/api/users/register', {
          method:'POST',
          headers:{ 'Content-Type':'application/json' },
          body: JSON.stringify(data)
        });
        if (res.ok) {
          const r = await res.json();
          localStorage.setItem('username', r.username);
          btn.textContent = '춰Creado!';
          setTimeout(()=> location.href='index.html', 420);
        } else {
          const err = await res.json().catch(()=>({message:'Error'}));
          alert(err.message || 'Error al registrarse');
        }
      } catch {
        alert('Error de red. Intenta de nuevo.');
      } finally {
        btn.disabled = false;
        btn.classList.remove('loading');
      }
    });
  </script>
</body>
</html>
